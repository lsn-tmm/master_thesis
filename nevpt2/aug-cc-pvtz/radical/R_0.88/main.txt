#INFO: **** input file is /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/aug-cc-pvtz/radical/R_0.88/main.py ****
import numpy as np
import sys
sys.path.append('../../../../nevpt2/src/')
import time
from basis_constructor import Basis_Constructor
from bo_class          import BO_class
from bo_solver         import BO_solver
from fci_qse_solver    import FCI_QSE_solver
from fci_solver        import FCI_solver
from vqe_qse_solver    import VQE_QSE_solver
from pyscf             import gto,scf
from VQE_types         import vqe_data

start = time.time()

outfile = open('results.txt','w')
mol = gto.M(atom=[['O',(0,0,0)],['H',(0,0,0.88)]],basis='aug-cc-pvtz',spin=1,charge=0,
            symmetry=True,verbose=4).build()
mf  = scf.ROHF(mol)
mf  = scf.newton(mf)
mf.kernel()
if(not mf.converged):
   mf.kernel(mf.make_rdm1())
mf.analyze()

BC_object = Basis_Constructor(mol,mf)
BC_object.compute_core_valence()
BC_object.compute_external()

BO_IAO = BO_class(mol,mf)
BO_IAO.transform_integrals(BC_object.valence)
BO_IAO = BO_IAO.freeze_orbitals([0])
BO_IAO_solver = BO_solver(BO_IAO)
#outfile.write("IAO, [1s frozen] SCF energy %.12f \n" % BO_IAO_solver.solve_with_scf()[1])
#outfile.write("IAO, [1s frozen] FCI energy %.12f \n" % BO_IAO_solver.solve_with_fci()[0])

BO_IAO_external = BO_class(mol,mf)
BO_IAO_external.transform_integrals(BC_object.return_basis())
BO_IAO_external = BO_IAO_external.freeze_orbitals([0])
BO_IAO_external_solver = BO_solver(BO_IAO_external)
#outfile.write("FULL, [1s frozen] SCF energy %.12f \n" % BO_IAO_external_solver.solve_with_scf()[1])
#outfile.write("FULL, [1s frozen] FCI energy %.12f \n" % BO_IAO_external_solver.solve_with_fci()[0])

SOLVER = FCI_solver(BO_IAO,BO_IAO_external)
#outfile.write("FCI+FCI [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())
SOLVER = FCI_QSE_solver(BO_IAO,BO_IAO_external)
outfile.write("FCI+QSE [1s frozen] NEVPT2 energy  %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

VQE_settings = vqe_data()
SOLVER = VQE_QSE_solver(BO_IAO,BO_IAO_external)
VQE_settings.target_sector = 11
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(q-UCCSD)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_q_uccsd_output.npy',allow_pickle=True).item()
outfile.write("VQE(q-UCCSD) energy %.12f \n" % x['energy'])

x = np.load('PARAMETER_FILE.npy',allow_pickle=True).item()
VQE_settings.initial_point = x['opt_params']

VQE_settings.ansatz = 'su2'
VQE_settings.optimizer = 'cg'
VQE_settings.reps = 3
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(Ry)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_su2_output.npy',allow_pickle=True).item()
outfile.write("VQE(Ry) energy (I) %.12f \n" % x['energy'])
VQE_settings.instance = 'statevector_simulator'
VQE_settings.optimizer = 'cobyla'
VQE_settings.max_iter = 0
VQE_settings.initial_point = x['opt_params']
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(Ry)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_su2_output.npy',allow_pickle=True).item()
outfile.write("VQE(Ry) energy (II) %.12f \n" % x['energy'])

end = time.time()

outfile.write("Total time execution %.2f s\n" % (end-start))
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='lab49.labcalcolo.lab', release='4.18.0-348.7.1.el8_5.x86_64', version='#1 SMP Tue Dec 21 19:02:23 UTC 2021', machine='x86_64', processor='x86_64')  Threads 12
Python 3.8.8 (default, Apr 13 2021, 19:58:26) 
[GCC 7.3.0]
numpy 1.20.1  scipy 1.6.2
Date: Tue Jan 25 21:24:22 2022
PySCF version 2.0.1
PySCF path  /home/studenti/alessandro.tammaro/.local/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 9
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 1
[INPUT] symmetry True subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 O      0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr
[INPUT]  2 H      0.000000000000   0.000000000000   0.880000000000 AA    0.000000000000   0.000000000000   1.662958989617 Bohr

nuclear repulsion = 4.81070191745455
point group symmetry = Coov
num. orbitals of irrep A1 = 23
num. orbitals of irrep E1x = 14
num. orbitals of irrep E1y = 14
num. orbitals of irrep E2x = 7
num. orbitals of irrep E2y = 7
num. orbitals of irrep E3x = 2
num. orbitals of irrep E3y = 2
number of shells = 22
number of NR pGTOs = 83
number of NR cGTOs = 69
basis = aug-cc-pvtz
ecp = {}
CPU time:         4.10
Freeze 0 electrons in irreps []
    9 free electrons in irreps A1 E1x E1y E2x E2y E3x E3y




******** <class 'pyscf.scf.hf_symm.SymAdaptedROHF'> ********
method = SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/aug-cc-pvtz/radical/R_0.88/tmp6d2oj_c0
max_memory 4000 MB (current use 272 MB)
num. doubly occ = 4  num. singly occ = 1
******** <class 'pyscf.scf.hf_symm.SymAdaptedROHF'> Newton solver flags ********
SCF tol = 1e-09
conv_tol_grad = None
max. SCF cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/aug-cc-pvtz/radical/R_0.88/tmp6d2oj_c0
max_cycle_inner = 12
max_stepsize = 0.05
ah_start_tol = 1e+09
ah_level_shift = 0
ah_conv_tol = 1e-12
ah_lindep = 1e-14
ah_start_cycle = 1
ah_max_cycle = 40
ah_grad_trust_region = 2.5
kf_interval = 4
kf_trust_region = 5
canonicalization = True
max_memory 4000 MB (current use 272 MB)
Set conv_tol_grad to 3.16228e-05
HOMO (E1y) = -0.44726669228078  LUMO (A1) = 0.0289692095965957
Initial guess E= -75.3991553372531  |g|= 0.20872
macro= 0  E= -75.407693615963  delta_E= -0.00853828  |g|= 0.20872  2 KF 5 JK
macro= 1  E= -75.4085048626768  delta_E= -0.000811247  |g|= 0.0963123  2 KF 5 JK
macro= 2  E= -75.4068511324353  delta_E= 0.00165373  |g|= 0.0602266  2 KF 5 JK
macro= 3  E= -75.4084233937294  delta_E= -0.00157226  |g|= 0.108701  2 KF 5 JK
macro= 4  E= -75.4072802555755  delta_E= 0.00114314  |g|= 0.0601236  2 KF 5 JK
macro= 5  E= -75.4084504465086  delta_E= -0.00117019  |g|= 0.102525  2 KF 5 JK
macro= 6  E= -75.407157751323  delta_E= 0.0012927  |g|= 0.0596022  2 KF 5 JK
macro= 7  E= -75.4084511857174  delta_E= -0.00129343  |g|= 0.104368  2 KF 5 JK
macro= 8  E= -75.4071799435093  delta_E= 0.00127124  |g|= 0.0599096  2 KF 5 JK
macro= 9  E= -75.4084551841423  delta_E= -0.00127524  |g|= 0.104055  2 KF 5 JK
macro= 10  E= -75.4071476183129  delta_E= 0.00130757  |g|= 0.0597572  2 KF 5 JK
macro= 11  E= -75.4084586978718  delta_E= -0.00131108  |g|= 0.104606  2 KF 5 JK
macro= 12  E= -75.4071366793289  delta_E= 0.00132202  |g|= 0.0597526  2 KF 5 JK
macro= 13  E= -75.4084622373955  delta_E= -0.00132556  |g|= 0.104822  2 KF 5 JK
macro= 14  E= -75.4071175710291  delta_E= 0.00134467  |g|= 0.0596608  2 KF 5 JK
macro= 15  E= -75.4084658179492  delta_E= -0.00134825  |g|= 0.105161  2 KF 5 JK
macro= 16  E= -75.4071018840166  delta_E= 0.00136393  |g|= 0.0595953  2 KF 5 JK
macro= 17  E= -75.4084693675969  delta_E= -0.00136748  |g|= 0.105444  2 KF 5 JK
macro= 18  E= -75.4070850376396  delta_E= 0.00138433  |g|= 0.0595144  2 KF 5 JK
macro= 19  E= -75.4084729365953  delta_E= -0.0013879  |g|= 0.105741  2 KF 5 JK
macro= 20  E= -75.4070688654015  delta_E= 0.00140407  |g|= 0.0594373  2 KF 5 JK
macro= 21  E= -75.4084764919757  delta_E= -0.00140763  |g|= 0.106025  2 KF 5 JK
macro= 22  E= -75.4070526482428  delta_E= 0.00142384  |g|= 0.0593567  2 KF 5 JK
macro= 23  E= -75.4084800485014  delta_E= -0.0014274  |g|= 0.106305  2 KF 5 JK
macro= 24  E= -75.4070366881088  delta_E= 0.00144336  |g|= 0.0592758  2 KF 5 JK
macro= 25  E= -75.4084835954353  delta_E= -0.00144691  |g|= 0.106579  2 KF 5 JK
macro= 26  E= -75.4070208755216  delta_E= 0.00146272  |g|= 0.0591936  2 KF 5 JK
macro= 27  E= -75.4084871350738  delta_E= -0.00146626  |g|= 0.106848  2 KF 5 JK
macro= 28  E= -75.4070052663387  delta_E= 0.00148187  |g|= 0.0591105  2 KF 5 JK
macro= 29  E= -75.4084906632259  delta_E= -0.0014854  |g|= 0.10711  2 KF 5 JK
macro= 30  E= -75.4069898482552  delta_E= 0.00150081  |g|= 0.0590265  2 KF 5 JK
macro= 31  E= -75.4084941789049  delta_E= -0.00150433  |g|= 0.107367  2 KF 5 JK
macro= 32  E= -75.4069746358324  delta_E= 0.00151954  |g|= 0.0589416  2 KF 5 JK
macro= 33  E= -75.4084976796086  delta_E= -0.00152304  |g|= 0.107618  2 KF 5 JK
macro= 34  E= -75.4069596316332  delta_E= 0.00153805  |g|= 0.0588559  2 KF 5 JK
macro= 35  E= -75.4085011636115  delta_E= -0.00154153  |g|= 0.107863  2 KF 5 JK
macro= 36  E= -75.4069448422432  delta_E= 0.00155632  |g|= 0.0587695  2 KF 5 JK
macro= 37  E= -75.4085046288754  delta_E= -0.00155979  |g|= 0.108103  2 KF 5 JK
macro= 38  E= -75.4069302716677  delta_E= 0.00157436  |g|= 0.0586823  2 KF 5 JK
macro= 39  E= -75.4085080735776  delta_E= -0.0015778  |g|= 0.108337  2 KF 5 JK
macro= 40  E= -75.4069159241137  delta_E= 0.00159215  |g|= 0.0585946  2 KF 5 JK
macro= 41  E= -75.40851149587  delta_E= -0.00159557  |g|= 0.108565  2 KF 5 JK
macro= 42  E= -75.4069018028593  delta_E= 0.00160969  |g|= 0.0585062  2 KF 5 JK
macro= 43  E= -75.4085148939995  delta_E= -0.00161309  |g|= 0.108788  2 KF 5 JK
macro= 44  E= -75.4068879107664  delta_E= 0.00162698  |g|= 0.0584174  2 KF 5 JK
macro= 45  E= -75.4085182662602  delta_E= -0.00163036  |g|= 0.109005  2 KF 5 JK
macro= 46  E= -75.4068742501011  delta_E= 0.00164402  |g|= 0.0583281  2 KF 5 JK
macro= 47  E= -75.4085216110212  delta_E= -0.00164736  |g|= 0.109217  2 KF 5 JK
macro= 48  E= -75.4068608226471  delta_E= 0.00166079  |g|= 0.0582385  2 KF 5 JK
macro= 49  E= -75.4085249267197  delta_E= -0.0016641  |g|= 0.109424  2 KF 5 JK
Canonicalize SCF orbitals
macro X = 50  E=-75.4085249267197  |g|= 0.109424  total 101 KF 301 JK
SCF not converged.
SCF energy = -75.4085249267197

WARN: Newton solver expects mo_coeff with mo_occ as initial guess but mo_occ is not found in the arguments.
      The given argument is treated as density matrix.

Freeze 0 electrons in irreps []
    9 free electrons in irreps A1 E1x E1y E2x E2y E3x E3y




******** <class 'pyscf.scf.hf_symm.SymAdaptedROHF'> ********
method = SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/aug-cc-pvtz/radical/R_0.88/tmp6d2oj_c0
max_memory 4000 MB (current use 307 MB)
num. doubly occ = 4  num. singly occ = 1
******** <class 'pyscf.scf.hf_symm.SymAdaptedROHF'> Newton solver flags ********
SCF tol = 1e-09
conv_tol_grad = None
max. SCF cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/aug-cc-pvtz/radical/R_0.88/tmp6d2oj_c0
max_cycle_inner = 12
max_stepsize = 0.05
ah_start_tol = 1e+09
ah_level_shift = 0
ah_conv_tol = 1e-12
ah_lindep = 1e-14
ah_start_cycle = 1
ah_max_cycle = 40
ah_grad_trust_region = 2.5
kf_interval = 4
kf_trust_region = 5
canonicalization = True
max_memory 4000 MB (current use 307 MB)
Set conv_tol_grad to 3.16228e-05
HOMO (E1y) = -0.269610256733006  LUMO (A1) = 0.0312245153313455
Initial guess E= -75.4099020823442  |g|= 0.0385162
macro= 0  E= -75.4100740246092  delta_E= -0.000171942  |g|= 0.0385162  2 KF 5 JK
macro= 1  E= -75.4100604957354  delta_E= 1.35289e-05  |g|= 0.0193457  2 KF 5 JK
macro= 2  E= -75.4100687705145  delta_E= -8.27478e-06  |g|= 0.0281305  2 KF 5 JK
macro= 3  E= -75.4100576968412  delta_E= 1.10737e-05  |g|= 0.0200383  2 KF 5 JK
macro= 4  E= -75.410064575502  delta_E= -6.87866e-06  |g|= 0.0280881  2 KF 5 JK
macro= 5  E= -75.4100588707998  delta_E= 5.7047e-06  |g|= 0.0204956  2 KF 5 JK
macro= 6  E= -75.4100644604476  delta_E= -5.58965e-06  |g|= 0.0279927  2 KF 5 JK
macro= 7  E= -75.4100584710421  delta_E= 5.98941e-06  |g|= 0.0205337  2 KF 5 JK
macro= 8  E= -75.4100646837633  delta_E= -6.21272e-06  |g|= 0.0280244  2 KF 5 JK
macro= 9  E= -75.4100583393018  delta_E= 6.34446e-06  |g|= 0.0205312  2 KF 5 JK
macro= 10  E= -75.4100655452127  delta_E= -7.20591e-06  |g|= 0.0280427  2 KF 5 JK
macro= 11  E= -75.4100586455818  delta_E= 6.89963e-06  |g|= 0.0205104  2 KF 5 JK
macro= 12  E= -75.410065955483  delta_E= -7.3099e-06  |g|= 0.0280092  2 KF 5 JK
macro= 13  E= -75.410059923838  delta_E= 6.03165e-06  |g|= 0.0205873  2 KF 5 JK
macro= 14  E= -75.4100654202005  delta_E= -5.49636e-06  |g|= 0.0278709  2 KF 5 JK
macro= 15  E= -75.4100601864486  delta_E= 5.23375e-06  |g|= 0.0207199  2 KF 5 JK
macro= 16  E= -75.4100651428054  delta_E= -4.95636e-06  |g|= 0.0278111  2 KF 5 JK
macro= 17  E= -75.4100601964329  delta_E= 4.94637e-06  |g|= 0.0207844  2 KF 5 JK
macro= 18  E= -75.4100650465194  delta_E= -4.85009e-06  |g|= 0.0277898  2 KF 5 JK
macro= 19  E= -75.410060151922  delta_E= 4.8946e-06  |g|= 0.0208099  2 KF 5 JK
macro= 20  E= -75.4100649828442  delta_E= -4.83092e-06  |g|= 0.0277851  2 KF 5 JK
macro= 21  E= -75.4100601147924  delta_E= 4.86805e-06  |g|= 0.0208223  2 KF 5 JK
macro= 22  E= -75.4100649182241  delta_E= -4.80343e-06  |g|= 0.0277852  2 KF 5 JK
macro= 23  E= -75.4100600774139  delta_E= 4.84081e-06  |g|= 0.0208302  2 KF 5 JK
macro= 24  E= -75.4100648538017  delta_E= -4.77639e-06  |g|= 0.0277875  2 KF 5 JK
macro= 25  E= -75.4100600406425  delta_E= 4.81316e-06  |g|= 0.0208362  2 KF 5 JK
macro= 26  E= -75.410064789637  delta_E= -4.74899e-06  |g|= 0.0277908  2 KF 5 JK
macro= 27  E= -75.4100600038252  delta_E= 4.78581e-06  |g|= 0.0208412  2 KF 5 JK
macro= 28  E= -75.4100647257111  delta_E= -4.72189e-06  |g|= 0.0277944  2 KF 5 JK
macro= 29  E= -75.4100599671023  delta_E= 4.75861e-06  |g|= 0.0208458  2 KF 5 JK
macro= 30  E= -75.4100646619279  delta_E= -4.69483e-06  |g|= 0.0277982  2 KF 5 JK
macro= 31  E= -75.4100599303883  delta_E= 4.73154e-06  |g|= 0.0208502  2 KF 5 JK
macro= 32  E= -75.4100645982774  delta_E= -4.66789e-06  |g|= 0.027802  2 KF 5 JK
macro= 33  E= -75.4100598936814  delta_E= 4.7046e-06  |g|= 0.0208546  2 KF 5 JK
macro= 34  E= -75.4100645347516  delta_E= -4.64107e-06  |g|= 0.0278059  2 KF 5 JK
macro= 35  E= -75.4100598569688  delta_E= 4.67778e-06  |g|= 0.0208589  2 KF 5 JK
macro= 36  E= -75.4100644713494  delta_E= -4.61438e-06  |g|= 0.0278098  2 KF 5 JK
macro= 37  E= -75.4100598202491  delta_E= 4.6511e-06  |g|= 0.0208632  2 KF 5 JK
macro= 38  E= -75.4100644080692  delta_E= -4.58782e-06  |g|= 0.0278137  2 KF 5 JK
macro= 39  E= -75.4100597835205  delta_E= 4.62455e-06  |g|= 0.0208675  2 KF 5 JK
macro= 40  E= -75.4100643449105  delta_E= -4.56139e-06  |g|= 0.0278176  2 KF 5 JK
macro= 41  E= -75.4100597467828  delta_E= 4.59813e-06  |g|= 0.0208718  2 KF 5 JK
macro= 42  E= -75.4100642818738  delta_E= -4.53509e-06  |g|= 0.0278214  2 KF 5 JK
macro= 43  E= -75.4100597100355  delta_E= 4.57184e-06  |g|= 0.020876  2 KF 5 JK
macro= 44  E= -75.4100642189585  delta_E= -4.50892e-06  |g|= 0.0278253  2 KF 5 JK
macro= 45  E= -75.4100596732791  delta_E= 4.54568e-06  |g|= 0.0208803  2 KF 5 JK
macro= 46  E= -75.410064156165  delta_E= -4.48289e-06  |g|= 0.0278292  2 KF 5 JK
macro= 47  E= -75.4100596365136  delta_E= 4.51965e-06  |g|= 0.0208845  2 KF 5 JK
macro= 48  E= -75.4100640934927  delta_E= -4.45698e-06  |g|= 0.0278331  2 KF 5 JK
macro= 49  E= -75.4100595997392  delta_E= 4.49375e-06  |g|= 0.0208887  2 KF 5 JK
Canonicalize SCF orbitals
macro X = 50  E=-75.4100595997392  |g|= 0.0208887  total 101 KF 301 JK
SCF not converged.
SCF energy = -75.4100595997392
**** SCF Summaries ****
Total Energy =                         -75.410059599739228
Nuclear Repulsion Energy =               4.810701917454545
One-electron Energy =                 -113.478526223962376
Two-electron Energy =                   33.257764706768590
Wave-function symmetry = Coov
occupancy for each irrep:     A1  E1x  E1y  E2x  E2y  E3x  E3y
double occ                     3    1    0    0    0    0    0
single occ                     0    0    1    0    0    0    0
**** MO energy ****
                          Roothaan           | alpha              | beta
MO #1   (A1  #1 ) energy= -20.6002484461495  | -20.6172460759259  | -20.5832508163732  occ= 2
MO #2   (A1  #2 ) energy= -1.33739905234975  | -1.40623161293597  | -1.26856649176353  occ= 2
MO #3   (A1  #3 ) energy= -0.682193886689491 | -0.704884992731303 | -0.659502780647679 occ= 2
MO #4   (E1x #1 ) energy= -0.538493255514778 | -0.557757783965053 | -0.519228727064503 occ= 2
MO #5   (E1y #1 ) energy= -0.246853786267052 | -0.646327529018235 | 0.152619956484136  occ= 1
MO #6   (A1  #4 ) energy= 0.0312838106904264 | 0.0307695103242721 | 0.0317981110565796 occ= 0
MO #7   (A1  #5 ) energy= 0.13787621838421   | 0.137159561055241  | 0.13859287571317   occ= 0
MO #8   (E1y #2 ) energy= 0.157000507411093  | 0.151435841855662  | 0.162565172966525  occ= 0
MO #9   (E1x #2 ) energy= 0.160589654973314  | 0.159876517798882  | 0.161302792147745  occ= 0
MO #10  (A1  #6 ) energy= 0.189234614063044  | 0.187037054624674  | 0.1914321735014    occ= 0
MO #11  (A1  #7 ) energy= 0.268237235397594  | 0.26656478753329   | 0.26990968326191   occ= 0
MO #12  (E1y #3 ) energy= 0.276060788785561  | 0.272424323928129  | 0.279697253642997  occ= 0
MO #13  (E1x #3 ) energy= 0.279467749617586  | 0.27901196016812   | 0.279923539067054  occ= 0
MO #14  (A1  #8 ) energy= 0.448854663281611  | 0.445042956215844  | 0.452666370347203  occ= 0
MO #15  (E2x #1 ) energy= 0.64838728593729   | 0.638861184875392  | 0.657913386999189  occ= 0
MO #16  (E2y #1 ) energy= 0.648387285937289  | 0.63886118487539   | 0.657913386999188  occ= 0
MO #17  (A1  #9 ) energy= 0.66128693764818   | 0.655007358966081  | 0.667566516330298  occ= 0
MO #18  (E1y #4 ) energy= 0.723718767491144  | 0.714471468990872  | 0.732966065991417  occ= 0
MO #19  (E1x #4 ) energy= 0.729698515682199  | 0.728446638307591  | 0.730950393056812  occ= 0
MO #20  (E1y #5 ) energy= 0.872773218977176  | 0.848312224768776  | 0.89723421318558   occ= 0
MO #21  (E1x #5 ) energy= 0.875126780867891  | 0.872184228825915  | 0.878069332909866  occ= 0
MO #22  (A1  #10) energy= 0.88876377731743   | 0.883754600264695  | 0.893772954369993  occ= 0
MO #23  (A1  #11) energy= 0.918981997245558  | 0.916992190040427  | 0.920971804450684  occ= 0
MO #24  (E2x #2 ) energy= 0.946379651490911  | 0.944893033561475  | 0.947866269420348  occ= 0
MO #25  (E2y #2 ) energy= 0.946379651490903  | 0.944893033561465  | 0.947866269420338  occ= 0
MO #26  (E1y #6 ) energy= 1.0122254329708    | 0.990459364272642  | 1.03399150166896   occ= 0
MO #27  (E1x #6 ) energy= 1.02090047104154   | 1.01800230137286   | 1.02379864071021   occ= 0
MO #28  (A1  #12) energy= 1.0517440286868    | 1.04602527190388   | 1.05746278546962   occ= 0
MO #29  (E1y #7 ) energy= 1.55785291114616   | 1.54136981222552   | 1.57433601006681   occ= 0
MO #30  (E1x #7 ) energy= 1.56545969299173   | 1.56325417241397   | 1.56766521356949   occ= 0
MO #31  (A1  #13) energy= 1.67255089057      | 1.6626450012254    | 1.6824567799143    occ= 0
MO #32  (E3x #1 ) energy= 2.05027975352546   | 2.04022266033306   | 2.06033684671786   occ= 0
MO #33  (E3y #1 ) energy= 2.05027975352546   | 2.04022266033306   | 2.06033684671786   occ= 0
MO #34  (A1  #14) energy= 2.13463554527928   | 2.1245622290919    | 2.14470886146666   occ= 0
MO #35  (E2x #3 ) energy= 2.13637870581132   | 2.1009072956273    | 2.17185011599534   occ= 0
MO #36  (E2y #3 ) energy= 2.13637870581133   | 2.10090729562731   | 2.17185011599535   occ= 0
MO #37  (E1y #8 ) energy= 2.2976155131301    | 2.27862228074215   | 2.31660874551805   occ= 0
MO #38  (E1x #8 ) energy= 2.3150976158364    | 2.31194236158044   | 2.31825287009236   occ= 0
MO #39  (E2x #4 ) energy= 2.35589743469023   | 2.34787334852839   | 2.36392152085207   occ= 0
MO #40  (E2y #4 ) energy= 2.35589743469023   | 2.34787334852839   | 2.36392152085207   occ= 0
MO #41  (A1  #15) energy= 2.38638041967127   | 2.37856523274141   | 2.39419560660076   occ= 0
MO #42  (A1  #16) energy= 2.58813474696276   | 2.57945269710867   | 2.59681679681685   occ= 0
MO #43  (E1y #9 ) energy= 2.74222120595854   | 2.71791349311118   | 2.7665289188059    occ= 0
MO #44  (E1x #9 ) energy= 2.76381761616934   | 2.75954381184203   | 2.76809142049664   occ= 0
MO #45  (A1  #17) energy= 3.70175933749327   | 3.6966069050185    | 3.70691176996804   occ= 0
MO #46  (E2x #5 ) energy= 4.11708275954591   | 4.11367173686461   | 4.1204937822272    occ= 0
MO #47  (E2y #5 ) energy= 4.1170827595459    | 4.1136717368646    | 4.12049378222719   occ= 0
MO #48  (E1y #10) energy= 4.14089957912629   | 4.09937701405618   | 4.1824221441964    occ= 0
MO #49  (E1x #10) energy= 4.15184485757755   | 4.14619834234277   | 4.15749137281234   occ= 0
MO #50  (E1y #11) energy= 4.33772882210544   | 4.32226778324684   | 4.35318986096405   occ= 0
MO #51  (E1x #11) energy= 4.34857676593589   | 4.34644101045185   | 4.35071252141993   occ= 0
MO #52  (A1  #18) energy= 4.7178938078856    | 4.71251123096824   | 4.72327638480287   occ= 0
MO #53  (A1  #19) energy= 5.45155441932058   | 5.43888743211226   | 5.46422140652877   occ= 0
MO #54  (E1y #12) energy= 5.52247768289859   | 5.50275203788252   | 5.54220332791464   occ= 0
MO #55  (E1x #12) energy= 5.54852044084721   | 5.54459195493039   | 5.55244892676403   occ= 0
MO #56  (A1  #20) energy= 6.15324325470377   | 6.14272493441807   | 6.16376157498939   occ= 0
MO #57  (E3x #2 ) energy= 6.45860476973734   | 6.43360311878684   | 6.48360642068785   occ= 0
MO #58  (E3y #2 ) energy= 6.45860476973734   | 6.43360311878684   | 6.48360642068785   occ= 0
MO #59  (E2x #6 ) energy= 6.65863143616999   | 6.64013655958859   | 6.67712631275141   occ= 0
MO #60  (E2y #6 ) energy= 6.65863143616999   | 6.64013655958858   | 6.6771263127514    occ= 0
MO #61  (E2x #7 ) energy= 7.01458619401551   | 6.97333232484451   | 7.05584006318651   occ= 0
MO #62  (E2y #7 ) energy= 7.01458619401551   | 6.97333232484452   | 7.05584006318651   occ= 0
MO #63  (E1y #13) energy= 7.14524970098789   | 7.1123826030521    | 7.17811679892368   occ= 0
MO #64  (E1x #13) energy= 7.17763452947191   | 7.17188515175849   | 7.18338390718531   occ= 0
MO #65  (E1y #14) energy= 7.46090808146219   | 7.43575824956547   | 7.48605791335891   occ= 0
MO #66  (E1x #14) energy= 7.49414183351873   | 7.48906909033777   | 7.49921457669966   occ= 0
MO #67  (A1  #21) energy= 7.74838703770119   | 7.74066246120807   | 7.75611161419432   occ= 0
MO #68  (A1  #22) energy= 7.91470749352096   | 7.90421606318629   | 7.92519892385562   occ= 0
MO #69  (A1  #23) energy= 14.7369796265352   | 14.7239016855957   | 14.7500575674752   occ= 0
 ** Mulliken pop on meta-lowdin orthogonal AOs  **
 ** Mulliken pop  **
pop of  0 O 1s        1.99999
pop of  0 O 2s        1.77615
pop of  0 O 3s        0.00602
pop of  0 O 4s        0.00149
pop of  0 O 5s        0.00013
pop of  0 O 2px       1.99217
pop of  0 O 2py       0.99688
pop of  0 O 2pz       1.57023
pop of  0 O 3px       0.00088
pop of  0 O 3py       0.00019
pop of  0 O 3pz       0.00303
pop of  0 O 4px       0.00043
pop of  0 O 4py       0.00040
pop of  0 O 4pz       0.00163
pop of  0 O 5px       0.00016
pop of  0 O 5py       0.00003
pop of  0 O 5pz       0.00015
pop of  0 O 3dxy      0.00000
pop of  0 O 3dyz      0.00112
pop of  0 O 3dz^2     0.01124
pop of  0 O 3dxz      0.00242
pop of  0 O 3dx2-y2    0.00000
pop of  0 O 4dxy      0.00000
pop of  0 O 4dyz      0.00016
pop of  0 O 4dz^2     0.00061
pop of  0 O 4dxz      0.00039
pop of  0 O 4dx2-y2    0.00000
pop of  0 O 5dxy      0.00000
pop of  0 O 5dyz      0.00001
pop of  0 O 5dz^2     0.00022
pop of  0 O 5dxz      0.00003
pop of  0 O 5dx2-y2    0.00000
pop of  0 O 4f-3      0.00000
pop of  0 O 4f-2      0.00000
pop of  0 O 4f-1      0.00002
pop of  0 O 4f 0      0.00137
pop of  0 O 4f 1      0.00019
pop of  0 O 4f 2      0.00000
pop of  0 O 4f 3      0.00000
pop of  0 O 5f-3      0.00000
pop of  0 O 5f-2      0.00000
pop of  0 O 5f-1      0.00001
pop of  0 O 5f 0      0.00008
pop of  0 O 5f 1      0.00002
pop of  0 O 5f 2      0.00000
pop of  0 O 5f 3      0.00000
pop of  1 H 1s        0.60130
pop of  1 H 2s        0.01595
pop of  1 H 3s        0.00837
pop of  1 H 4s        0.00035
pop of  1 H 2px       0.00323
pop of  1 H 2py       0.00061
pop of  1 H 2pz       0.00062
pop of  1 H 3px       0.00002
pop of  1 H 3py       0.00044
pop of  1 H 3pz       0.00015
pop of  1 H 4px       0.00000
pop of  1 H 4py       0.00006
pop of  1 H 4pz       0.00030
pop of  1 H 3dxy      0.00000
pop of  1 H 3dyz      0.00002
pop of  1 H 3dz^2     0.00040
pop of  1 H 3dxz      0.00005
pop of  1 H 3dx2-y2    0.00000
pop of  1 H 4dxy      0.00000
pop of  1 H 4dyz      0.00005
pop of  1 H 4dz^2     0.00020
pop of  1 H 4dxz      0.00000
pop of  1 H 4dx2-y2    0.00000
 ** Mulliken atomic charges  **
charge of  0O =     -0.36786
charge of  1H =      0.36786
Dipole moment(X, Y, Z, Debye):  0.00000,  0.00000,  1.69256
#INFO: **** input file is /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/aug-cc-pvtz/radical/R_0.88/main.py ****
import numpy as np
import sys
sys.path.append('../../../../nevpt2/src/')
import time
from basis_constructor import Basis_Constructor
from bo_class          import BO_class
from bo_solver         import BO_solver
from fci_qse_solver    import FCI_QSE_solver
from fci_solver        import FCI_solver
from vqe_qse_solver    import VQE_QSE_solver
from pyscf             import gto,scf
from VQE_types         import vqe_data

start = time.time()

outfile = open('results.txt','w')
mol = gto.M(atom=[['O',(0,0,0)],['H',(0,0,0.88)]],basis='aug-cc-pvtz',spin=1,charge=0,
            symmetry=True,verbose=4).build()
mf  = scf.ROHF(mol)
mf  = scf.newton(mf)
mf.kernel()
if(not mf.converged):
   mf.kernel(mf.make_rdm1())
mf.analyze()

BC_object = Basis_Constructor(mol,mf)
BC_object.compute_core_valence()
BC_object.compute_external()

BO_IAO = BO_class(mol,mf)
BO_IAO.transform_integrals(BC_object.valence)
BO_IAO = BO_IAO.freeze_orbitals([0])
BO_IAO_solver = BO_solver(BO_IAO)
#outfile.write("IAO, [1s frozen] SCF energy %.12f \n" % BO_IAO_solver.solve_with_scf()[1])
#outfile.write("IAO, [1s frozen] FCI energy %.12f \n" % BO_IAO_solver.solve_with_fci()[0])

BO_IAO_external = BO_class(mol,mf)
BO_IAO_external.transform_integrals(BC_object.return_basis())
BO_IAO_external = BO_IAO_external.freeze_orbitals([0])
BO_IAO_external_solver = BO_solver(BO_IAO_external)
#outfile.write("FULL, [1s frozen] SCF energy %.12f \n" % BO_IAO_external_solver.solve_with_scf()[1])
#outfile.write("FULL, [1s frozen] FCI energy %.12f \n" % BO_IAO_external_solver.solve_with_fci()[0])

SOLVER = FCI_solver(BO_IAO,BO_IAO_external)
#outfile.write("FCI+FCI [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())
SOLVER = FCI_QSE_solver(BO_IAO,BO_IAO_external)
outfile.write("FCI+QSE [1s frozen] NEVPT2 energy  %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

VQE_settings = vqe_data()
SOLVER = VQE_QSE_solver(BO_IAO,BO_IAO_external)
VQE_settings.target_sector = 11
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(q-UCCSD)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_q_uccsd_output.npy',allow_pickle=True).item()
outfile.write("VQE(q-UCCSD) energy %.12f \n" % x['energy'])

x = np.load('PARAMETER_FILE.npy',allow_pickle=True).item()
VQE_settings.initial_point = x['opt_params']

VQE_settings.ansatz = 'su2'
VQE_settings.optimizer = 'cg'
VQE_settings.reps = 3
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(Ry)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_su2_output.npy',allow_pickle=True).item()
outfile.write("VQE(Ry) energy (I) %.12f \n" % x['energy'])
VQE_settings.instance = 'statevector_simulator'
VQE_settings.optimizer = 'cobyla'
VQE_settings.max_iter = 0
VQE_settings.initial_point = x['opt_params']
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(Ry)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_su2_output.npy',allow_pickle=True).item()
outfile.write("VQE(Ry) energy (II) %.12f \n" % x['energy'])

end = time.time()

outfile.write("Total time execution %.2f s\n" % (end-start))
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='lab49.labcalcolo.lab', release='4.18.0-348.7.1.el8_5.x86_64', version='#1 SMP Tue Dec 21 19:02:23 UTC 2021', machine='x86_64', processor='x86_64')  Threads 12
Python 3.8.8 (default, Apr 13 2021, 19:58:26) 
[GCC 7.3.0]
numpy 1.20.1  scipy 1.6.2
Date: Tue Jan 25 21:24:27 2022
PySCF version 2.0.1
PySCF path  /home/studenti/alessandro.tammaro/.local/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 0
[INPUT] num. electrons = 0
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom

nuclear repulsion = 0
number of shells = 0
number of NR pGTOs = 0
number of NR cGTOs = 0
basis = sto-3g
ecp = {}
CPU time:        64.19

WARN: Newton solver expects mo_coeff with mo_occ as initial guess but mo_occ is not found in the arguments.
      The given argument is treated as density matrix.





******** <class 'pyscf.scf.rohf.ROHF'> ********
method = ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/aug-cc-pvtz/radical/R_0.88/tmpxqa3kie6
max_memory 4000 MB (current use 318 MB)
num. doubly occ = 4  num. singly occ = 1
******** <class 'pyscf.scf.rohf.ROHF'> Newton solver flags ********
SCF tol = 1e-09
conv_tol_grad = None
max. SCF cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/aug-cc-pvtz/radical/R_0.88/tmpxqa3kie6
max_cycle_inner = 12
max_stepsize = 0.05
ah_start_tol = 1e+09
ah_level_shift = 0
ah_conv_tol = 1e-12
ah_lindep = 1e-14
ah_start_cycle = 1
ah_max_cycle = 40
ah_grad_trust_region = 2.5
kf_interval = 4
kf_trust_region = 5
canonicalization = True
max_memory 4000 MB (current use 318 MB)
Set conv_tol_grad to 3.16228e-05
  HOMO = -0.246853786267056  LUMO = 0.513731314350279
Initial guess E= -75.4100760198424  |g|= 0.000913764
macro= 0  E= -75.410076389004  delta_E= -3.69162e-07  |g|= 0.000913764  1 KF 3 JK
macro= 1  E= -75.4100763890039  delta_E= 1.42109e-14  |g|= 1.21184e-05  1 KF 2 JK
Canonicalize SCF orbitals
macro X = 2  E=-75.4100763890039  |g|= 1.21184e-05  total 3 KF 8 JK
converged SCF energy = -75.4100763890039
u+d contributions  -0.008017158038633034
uu+dd contributions  -0.03956052170650834
ud contributions  -0.13697595838700416
----- VQE data ------
target_sector:  None
optimizer:  bfgs
max_iter:  1000
instance:  statevector_simulator
shots:  1000
ansatz:  q_uccsd
initial_point:  None


qse operators prepared for  u
qse operators prepared for  d
qse operators prepared for  uu
qse operators prepared for  dd
qse operators prepared for  ud
after tapering qubits(H) =  6
qse operators tapered for  hamiltonian
qse operators tapered for  qse_s_u
qse operators tapered for  qse_h_u
qse operators tapered for  qse_s_d
qse operators tapered for  qse_h_d
qse operators tapered for  qse_s_uu
qse operators tapered for  qse_h_uu
qse operators tapered for  qse_s_dd
qse operators tapered for  qse_h_dd
qse operators tapered for  qse_s_ud
qse operators tapered for  qse_h_ud
     ┌───┐
q_0: ┤ X ├
     └───┘
q_1: ─────
     ┌───┐
q_2: ┤ X ├
     ├───┤
q_3: ┤ X ├
     └───┘
q_4: ─────
          
q_5: ─────
          
u+d contributions  -0.008016430028988036
uu+dd contributions  -0.039559457479125544
ud contributions  -0.13695985425545512
     ┌───┐
q_0: ┤ X ├
     └───┘
q_1: ─────
     ┌───┐
q_2: ┤ X ├
     ├───┤
q_3: ┤ X ├
     └───┘
q_4: ─────
          
q_5: ─────
          
u+d contributions  -0.007757426545860912
uu+dd contributions  -0.03932753531776813
ud contributions  -0.13689782907471323
     ┌───┐
q_0: ┤ X ├
     └───┘
q_1: ─────
     ┌───┐
q_2: ┤ X ├
     ├───┤
q_3: ┤ X ├
     └───┘
q_4: ─────
          
q_5: ─────
          
u+d contributions  -0.007757426545860912
uu+dd contributions  -0.03932753531776813
ud contributions  -0.13689782907471323
