\documentclass{report}
\usepackage{epstopdf}
\usepackage{tikz}
\usetikzlibrary{quantikz}

% per produrre le figure finali, scommenta queste linee

\usetikzlibrary{external}
\tikzset{external/system call={latex \tikzexternalcheckshellescape -halt-on-error
-interaction=batchmode -jobname "\image" "\texsource" &&
dvips -o "\image".ps "\image".dvi &&
ps2eps "\image.ps"}}
\tikzexternalize[shell escape=-enable-write18]

% ed esegui da terminale il comando sotto
% latex --shell-escape figure.tex

\begin{document}

\begin{figure}
\begin{quantikz}[column sep=0.2cm,row sep=0.2cm]
\lstick{$|x_0 \rangle$} & \gate{R_y^0(\theta_0^0)} 
& \ctrl{1} & \qw & \qw & \gate{R_y^0(\theta_1^0)} & \qw 
& \ctrl{1} & \qw & \qw & \gate{R_y^0(\theta_2^0)} & \qw 
& \ctrl{1} & \qw & \qw & \gate{R_y^0(\theta_3^0)} & \qw 
& \measure{\sigma_0} \\ %%%
\lstick{$|x_1 \rangle$} & \gate{R_y^1(\theta_0^1)} 
& \targ{} & \ctrl{1} & \qw & \gate{R_y^1(\theta_1^1)} & \qw 
& \targ{} & \ctrl{1} & \qw & \gate{R_y^1(\theta_2^1)} & \qw 
& \targ{} & \ctrl{1} & \qw & \gate{R_y^1(\theta_3^1)} & \qw 
& \measure{\sigma_1} \\ %%%
\lstick{$|x_2 \rangle$} & \gate{R_y^2(\theta_0^2)} 
& \qw & \targ{} & \ctrl{1} & \gate{R_y^2(\theta_1^2)} & \qw 
& \qw & \targ{} & \ctrl{1} & \gate{R_y^2(\theta_2^2)} & \qw 
& \qw & \targ{} & \ctrl{1} & \gate{R_y^2(\theta_3^2)} & \qw 
& \measure{\sigma_2} \\ %%%
\lstick{$|x_3 \rangle$} & \gate{R_y^3(\theta_0^3)} 
& \qw & \qw & \targ{} & \gate{R_y^3(\theta_1^3)} & \qw 
& \qw & \qw & \targ{} & \gate{R_y^3(\theta_2^3)} & \qw 
& \qw & \qw & \targ{} & \gate{R_y^3(\theta_3^3)} & \qw 
& \measure{\sigma_3} \\
\end{quantikz}
\end{figure}

\end{document}
