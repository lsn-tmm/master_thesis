#INFO: **** input file is /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/6-31ppg/radical/R_0.86/main.py ****
import numpy as np
import sys
sys.path.append('../../../../nevpt2/src/')
import time
from basis_constructor import Basis_Constructor
from bo_class          import BO_class
from bo_solver         import BO_solver
from fci_qse_solver    import FCI_QSE_solver
from fci_solver        import FCI_solver
from vqe_qse_solver    import VQE_QSE_solver
from pyscf             import gto,scf
from VQE_types         import vqe_data

start = time.time()

outfile = open('results.txt','w')
mol = gto.M(atom=[['O',(0,0,0)],['H',(0,0,0.86)]],basis='6-31++g',spin=1,charge=0,
            symmetry=True,verbose=4).build()
mf  = scf.ROHF(mol)
mf  = scf.newton(mf)
mf.kernel()
if(not mf.converged):
   mf.kernel(mf.make_rdm1())
mf.analyze()

BC_object = Basis_Constructor(mol,mf)
BC_object.compute_core_valence()
BC_object.compute_external()

BO_IAO = BO_class(mol,mf)
BO_IAO.transform_integrals(BC_object.valence)
BO_IAO = BO_IAO.freeze_orbitals([0])
BO_IAO_solver = BO_solver(BO_IAO)
#outfile.write("IAO, [1s frozen] SCF energy %.12f \n" % BO_IAO_solver.solve_with_scf()[1])
#outfile.write("IAO, [1s frozen] FCI energy %.12f \n" % BO_IAO_solver.solve_with_fci()[0])

BO_IAO_external = BO_class(mol,mf)
BO_IAO_external.transform_integrals(BC_object.return_basis())
BO_IAO_external = BO_IAO_external.freeze_orbitals([0])
BO_IAO_external_solver = BO_solver(BO_IAO_external)
#outfile.write("FULL, [1s frozen] SCF energy %.12f \n" % BO_IAO_external_solver.solve_with_scf()[1])
#outfile.write("FULL, [1s frozen] FCI energy %.12f \n" % BO_IAO_external_solver.solve_with_fci()[0])

SOLVER = FCI_solver(BO_IAO,BO_IAO_external)
#outfile.write("FCI+FCI [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())
SOLVER = FCI_QSE_solver(BO_IAO,BO_IAO_external)
outfile.write("FCI+QSE [1s frozen] NEVPT2 energy  %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

VQE_settings = vqe_data()
SOLVER = VQE_QSE_solver(BO_IAO,BO_IAO_external)
VQE_settings.target_sector = 11
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(q-UCCSD)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_q_uccsd_output.npy',allow_pickle=True).item()
outfile.write("VQE(q-UCCSD) energy %.12f \n" % x['energy'])

x = np.load('PARAMETER_FILE.npy',allow_pickle=True).item()
VQE_settings.initial_point = x['opt_params']

VQE_settings.ansatz = 'su2'
VQE_settings.optimizer = 'cg'
VQE_settings.reps = 3
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(Ry)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_su2_output.npy',allow_pickle=True).item()
outfile.write("VQE(Ry) energy (I) %.12f \n" % x['energy'])
VQE_settings.instance = 'statevector_simulator'
VQE_settings.optimizer = 'cobyla'
VQE_settings.max_iter = 0
VQE_settings.initial_point = x['opt_params']
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(Ry)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_su2_output.npy',allow_pickle=True).item()
outfile.write("VQE(Ry) energy (II) %.12f \n" % x['energy'])

end = time.time()

outfile.write("Total time execution %.2f s\n" % (end-start))
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='lab23.labcalcolo.lab', release='4.18.0-348.7.1.el8_5.x86_64', version='#1 SMP Tue Dec 21 19:02:23 UTC 2021', machine='x86_64', processor='x86_64')  Threads 12
Python 3.8.8 (default, Apr 13 2021, 19:58:26) 
[GCC 7.3.0]
numpy 1.20.1  scipy 1.6.2
Date: Tue Jan 25 14:06:58 2022
PySCF version 2.0.1
PySCF path  /home/studenti/alessandro.tammaro/.local/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 9
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 1
[INPUT] symmetry True subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 O      0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr
[INPUT]  2 H      0.000000000000   0.000000000000   0.860000000000 AA    0.000000000000   0.000000000000   1.625164467126 Bohr

nuclear repulsion = 4.92257870623256
point group symmetry = Coov
num. orbitals of irrep A1 = 10
num. orbitals of irrep E1x = 3
num. orbitals of irrep E1y = 3
number of shells = 10
number of NR pGTOs = 31
number of NR cGTOs = 16
basis = 6-31++g
ecp = {}
CPU time:         4.09
Freeze 0 electrons in irreps []
    9 free electrons in irreps A1 E1x E1y




******** <class 'pyscf.scf.hf_symm.SymAdaptedROHF'> ********
method = SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/6-31ppg/radical/R_0.86/tmpai5e7vme
max_memory 4000 MB (current use 268 MB)
num. doubly occ = 4  num. singly occ = 1
******** <class 'pyscf.scf.hf_symm.SymAdaptedROHF'> Newton solver flags ********
SCF tol = 1e-09
conv_tol_grad = None
max. SCF cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/6-31ppg/radical/R_0.86/tmpai5e7vme
max_cycle_inner = 12
max_stepsize = 0.05
ah_start_tol = 1e+09
ah_level_shift = 0
ah_conv_tol = 1e-12
ah_lindep = 1e-14
ah_start_cycle = 1
ah_max_cycle = 40
ah_grad_trust_region = 2.5
kf_interval = 4
kf_trust_region = 5
canonicalization = True
max_memory 4000 MB (current use 268 MB)
Set conv_tol_grad to 3.16228e-05
HOMO (E1y) = -0.445116054765939  LUMO (A1) = 0.0436524652276232
Initial guess E= -75.3422715208193  |g|= 0.180012
macro= 0  E= -75.3507689235902  delta_E= -0.0084974  |g|= 0.180012  2 KF 5 JK
macro= 1  E= -75.3507136694278  delta_E= 5.52542e-05  |g|= 0.0872221  2 KF 5 JK
macro= 2  E= -75.3503954505652  delta_E= 0.000318219  |g|= 0.0690504  2 KF 5 JK
macro= 3  E= -75.3496141085881  delta_E= 0.000781342  |g|= 0.0960149  2 KF 5 JK
macro= 4  E= -75.3509739311275  delta_E= -0.00135982  |g|= 0.0929763  2 KF 5 JK
macro= 5  E= -75.349664414429  delta_E= 0.00130952  |g|= 0.0873509  2 KF 5 JK
macro= 6  E= -75.3510004228024  delta_E= -0.00133601  |g|= 0.0925492  2 KF 5 JK
macro= 7  E= -75.3496646779327  delta_E= 0.00133574  |g|= 0.0868051  2 KF 5 JK
macro= 8  E= -75.3509961233784  delta_E= -0.00133145  |g|= 0.0925619  2 KF 5 JK
macro= 9  E= -75.3496530197261  delta_E= 0.0013431  |g|= 0.0869093  2 KF 5 JK
macro= 10  E= -75.3509919134609  delta_E= -0.00133889  |g|= 0.0927402  2 KF 5 JK
macro= 11  E= -75.3496415804341  delta_E= 0.00135033  |g|= 0.0870306  2 KF 5 JK
macro= 12  E= -75.3509875716442  delta_E= -0.00134599  |g|= 0.0929073  2 KF 5 JK
macro= 13  E= -75.3496302466845  delta_E= 0.00135732  |g|= 0.0871578  2 KF 5 JK
macro= 14  E= -75.3509832544192  delta_E= -0.00135301  |g|= 0.0930707  2 KF 5 JK
macro= 15  E= -75.3496190674801  delta_E= 0.00136419  |g|= 0.0872848  2 KF 5 JK
macro= 16  E= -75.3509789646825  delta_E= -0.0013599  |g|= 0.093231  2 KF 5 JK
macro= 17  E= -75.3496080371112  delta_E= 0.00137093  |g|= 0.0874108  2 KF 5 JK
macro= 18  E= -75.3509747041804  delta_E= -0.00136667  |g|= 0.0933883  2 KF 5 JK
macro= 19  E= -75.3495971541781  delta_E= 0.00137755  |g|= 0.0875356  2 KF 5 JK
macro= 20  E= -75.3509704734304  delta_E= -0.00137332  |g|= 0.093543  2 KF 5 JK
macro= 21  E= -75.3495864174564  delta_E= 0.00138406  |g|= 0.0876591  2 KF 5 JK
macro= 22  E= -75.3509662728276  delta_E= -0.00137986  |g|= 0.0936951  2 KF 5 JK
macro= 23  E= -75.3495758257525  delta_E= 0.00139045  |g|= 0.0877814  2 KF 5 JK
macro= 24  E= -75.3509621027361  delta_E= -0.00138628  |g|= 0.0938445  2 KF 5 JK
macro= 25  E= -75.3495653778532  delta_E= 0.00139672  |g|= 0.0879025  2 KF 5 JK
macro= 26  E= -75.3509579634975  delta_E= -0.00139259  |g|= 0.0939914  2 KF 5 JK
macro= 27  E= -75.3495550725199  delta_E= 0.00140289  |g|= 0.0880223  2 KF 5 JK
macro= 28  E= -75.3509538554316  delta_E= -0.00139878  |g|= 0.0941357  2 KF 5 JK
macro= 29  E= -75.3495449084897  delta_E= 0.00140895  |g|= 0.0881408  2 KF 5 JK
macro= 30  E= -75.3509497788358  delta_E= -0.00140487  |g|= 0.0942776  2 KF 5 JK
macro= 31  E= -75.3495348844765  delta_E= 0.00141489  |g|= 0.0882582  2 KF 5 JK
macro= 32  E= -75.3509457339855  delta_E= -0.00141085  |g|= 0.094417  2 KF 5 JK
macro= 33  E= -75.349524999173  delta_E= 0.00142073  |g|= 0.0883742  2 KF 5 JK
macro= 34  E= -75.3509417211349  delta_E= -0.00141672  |g|= 0.0945541  2 KF 5 JK
macro= 35  E= -75.3495152512534  delta_E= 0.00142647  |g|= 0.0884891  2 KF 5 JK
macro= 36  E= -75.3509377405175  delta_E= -0.00142249  |g|= 0.0946887  2 KF 5 JK
macro= 37  E= -75.349505639374  delta_E= 0.0014321  |g|= 0.0886027  2 KF 5 JK
macro= 38  E= -75.3509337923465  delta_E= -0.00142815  |g|= 0.0948211  2 KF 5 JK
macro= 39  E= -75.3494961621765  delta_E= 0.00143763  |g|= 0.088715  2 KF 5 JK
macro= 40  E= -75.3509298768155  delta_E= -0.00143371  |g|= 0.0949511  2 KF 5 JK
macro= 41  E= -75.349486818288  delta_E= 0.00144306  |g|= 0.0888262  2 KF 5 JK
macro= 42  E= -75.3509259940989  delta_E= -0.00143918  |g|= 0.095079  2 KF 5 JK
macro= 43  E= -75.3494776063243  delta_E= 0.00144839  |g|= 0.0889361  2 KF 5 JK
macro= 44  E= -75.3509221443533  delta_E= -0.00144454  |g|= 0.0952046  2 KF 5 JK
macro= 45  E= -75.34946852489  delta_E= 0.00145362  |g|= 0.0890448  2 KF 5 JK
macro= 46  E= -75.3509183277171  delta_E= -0.0014498  |g|= 0.095328  2 KF 5 JK
macro= 47  E= -75.3494595725811  delta_E= 0.00145876  |g|= 0.0891523  2 KF 5 JK
macro= 48  E= -75.3509145443112  delta_E= -0.00145497  |g|= 0.0954493  2 KF 5 JK
macro= 49  E= -75.3494507479859  delta_E= 0.0014638  |g|= 0.0892586  2 KF 5 JK
Canonicalize SCF orbitals
macro X = 50  E=-75.3494507479859  |g|= 0.0892586  total 101 KF 301 JK
SCF not converged.
SCF energy = -75.3494507479859

WARN: Newton solver expects mo_coeff with mo_occ as initial guess but mo_occ is not found in the arguments.
      The given argument is treated as density matrix.

Freeze 0 electrons in irreps []
    9 free electrons in irreps A1 E1x E1y




******** <class 'pyscf.scf.hf_symm.SymAdaptedROHF'> ********
method = SymAdaptedROHF-ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/6-31ppg/radical/R_0.86/tmpai5e7vme
max_memory 4000 MB (current use 277 MB)
num. doubly occ = 4  num. singly occ = 1
******** <class 'pyscf.scf.hf_symm.SymAdaptedROHF'> Newton solver flags ********
SCF tol = 1e-09
conv_tol_grad = None
max. SCF cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/6-31ppg/radical/R_0.86/tmpai5e7vme
max_cycle_inner = 12
max_stepsize = 0.05
ah_start_tol = 1e+09
ah_level_shift = 0
ah_conv_tol = 1e-12
ah_lindep = 1e-14
ah_start_cycle = 1
ah_max_cycle = 40
ah_grad_trust_region = 2.5
kf_interval = 4
kf_trust_region = 5
canonicalization = True
max_memory 4000 MB (current use 277 MB)
Set conv_tol_grad to 3.16228e-05
HOMO (E1y) = -0.290091299002171  LUMO (A1) = 0.0429289449464845
Initial guess E= -75.3523725011045  |g|= 0.063353
macro= 0  E= -75.3530669635644  delta_E= -0.000694462  |g|= 0.063353  2 KF 5 JK
macro= 1  E= -75.3531295910531  delta_E= -6.26275e-05  |g|= 0.0241265  2 KF 5 JK
macro= 2  E= -75.352979059845  delta_E= 0.000150531  |g|= 0.0147781  2 KF 5 JK
macro= 3  E= -75.3531285299934  delta_E= -0.00014947  |g|= 0.0289544  2 KF 5 JK
macro= 4  E= -75.3529865956723  delta_E= 0.000141934  |g|= 0.0120134  2 KF 5 JK
macro= 5  E= -75.3531141780201  delta_E= -0.000127582  |g|= 0.0290072  2 KF 5 JK
macro= 6  E= -75.3530432077013  delta_E= 7.09703e-05  |g|= 0.014701  2 KF 5 JK
macro= 7  E= -75.353108628333  delta_E= -6.54206e-05  |g|= 0.0255418  2 KF 5 JK
macro= 8  E= -75.3530180259856  delta_E= 9.06023e-05  |g|= 0.0142908  2 KF 5 JK
macro= 9  E= -75.3530818012337  delta_E= -6.37752e-05  |g|= 0.026629  2 KF 5 JK
macro= 10  E= -75.3530266436042  delta_E= 5.51576e-05  |g|= 0.0183779  2 KF 5 JK
macro= 11  E= -75.353092399534  delta_E= -6.57559e-05  |g|= 0.0267053  2 KF 5 JK
macro= 12  E= -75.3530215685942  delta_E= 7.08309e-05  |g|= 0.0167002  2 KF 5 JK
macro= 13  E= -75.3530880312773  delta_E= -6.64627e-05  |g|= 0.0265846  2 KF 5 JK
macro= 14  E= -75.3530248273333  delta_E= 6.32039e-05  |g|= 0.0176253  2 KF 5 JK
macro= 15  E= -75.3530929888904  delta_E= -6.81616e-05  |g|= 0.0266025  2 KF 5 JK
macro= 16  E= -75.3530232161523  delta_E= 6.97727e-05  |g|= 0.0168417  2 KF 5 JK
macro= 17  E= -75.353091559484  delta_E= -6.83433e-05  |g|= 0.0265334  2 KF 5 JK
macro= 18  E= -75.3530240555788  delta_E= 6.75039e-05  |g|= 0.0171476  2 KF 5 JK
macro= 19  E= -75.3530927285422  delta_E= -6.8673e-05  |g|= 0.0265594  2 KF 5 JK
macro= 20  E= -75.3530237752683  delta_E= 6.89533e-05  |g|= 0.0169594  2 KF 5 JK
macro= 21  E= -75.3530922472201  delta_E= -6.8472e-05  |g|= 0.0265307  2 KF 5 JK
macro= 22  E= -75.3530239546377  delta_E= 6.82926e-05  |g|= 0.0170606  2 KF 5 JK
macro= 23  E= -75.3530922942682  delta_E= -6.83396e-05  |g|= 0.0265391  2 KF 5 JK
macro= 24  E= -75.353023980861  delta_E= 6.83134e-05  |g|= 0.0170629  2 KF 5 JK
macro= 25  E= -75.3530920258902  delta_E= -6.8045e-05  |g|= 0.0265272  2 KF 5 JK
macro= 26  E= -75.3530240826621  delta_E= 6.79432e-05  |g|= 0.0171269  2 KF 5 JK
macro= 27  E= -75.3530918266508  delta_E= -6.7744e-05  |g|= 0.0265225  2 KF 5 JK
macro= 28  E= -75.3530241793459  delta_E= 6.76473e-05  |g|= 0.0171817  2 KF 5 JK
macro= 29  E= -75.3530915725809  delta_E= -6.73932e-05  |g|= 0.0265117  2 KF 5 JK
macro= 30  E= -75.3530242794035  delta_E= 6.72932e-05  |g|= 0.0172503  2 KF 5 JK
macro= 31  E= -75.353091319676  delta_E= -6.70403e-05  |g|= 0.0265014  2 KF 5 JK
macro= 32  E= -75.3530243670507  delta_E= 6.69526e-05  |g|= 0.0173199  2 KF 5 JK
macro= 33  E= -75.3530910629286  delta_E= -6.66959e-05  |g|= 0.0264903  2 KF 5 JK
macro= 34  E= -75.3530244328677  delta_E= 6.66301e-05  |g|= 0.0173895  2 KF 5 JK
macro= 35  E= -75.3530908135578  delta_E= -6.63807e-05  |g|= 0.0264805  2 KF 5 JK
macro= 36  E= -75.3530244750214  delta_E= 6.63385e-05  |g|= 0.0174551  2 KF 5 JK
macro= 37  E= -75.3530905766982  delta_E= -6.61017e-05  |g|= 0.0264722  2 KF 5 JK
macro= 38  E= -75.3530244940166  delta_E= 6.60827e-05  |g|= 0.0175147  2 KF 5 JK
macro= 39  E= -75.3530903544126  delta_E= -6.58604e-05  |g|= 0.0264659  2 KF 5 JK
macro= 40  E= -75.3530244941677  delta_E= 6.58602e-05  |g|= 0.0175674  2 KF 5 JK
macro= 41  E= -75.3530901469185  delta_E= -6.56528e-05  |g|= 0.0264617  2 KF 5 JK
macro= 42  E= -75.3530244795381  delta_E= 6.56674e-05  |g|= 0.0176132  2 KF 5 JK
macro= 43  E= -75.3530899523338  delta_E= -6.54728e-05  |g|= 0.0264594  2 KF 5 JK
macro= 44  E= -75.35302445416  delta_E= 6.54982e-05  |g|= 0.0176528  2 KF 5 JK
macro= 45  E= -75.3530897684792  delta_E= -6.53143e-05  |g|= 0.0264589  2 KF 5 JK
macro= 46  E= -75.3530244210498  delta_E= 6.53474e-05  |g|= 0.017687  2 KF 5 JK
macro= 47  E= -75.3530895929886  delta_E= -6.51719e-05  |g|= 0.0264597  2 KF 5 JK
macro= 48  E= -75.3530243825238  delta_E= 6.52105e-05  |g|= 0.0177167  2 KF 5 JK
macro= 49  E= -75.3530894238995  delta_E= -6.50414e-05  |g|= 0.0264618  2 KF 5 JK
Canonicalize SCF orbitals
macro X = 50  E=-75.3530894238995  |g|= 0.0264618  total 101 KF 301 JK
SCF not converged.
SCF energy = -75.3530894238995
**** SCF Summaries ****
Total Energy =                         -75.353089423899476
Nuclear Repulsion Energy =               4.922578706232559
One-electron Energy =                 -113.417415216405729
Two-electron Energy =                   33.141747086273703
Wave-function symmetry = Coov
occupancy for each irrep:     A1  E1x  E1y
double occ                     3    1    0
single occ                     0    0    1
**** MO energy ****
                          Roothaan           | alpha              | beta
MO #1   (A1  #1 ) energy= -20.6350047568379  | -20.651716773208   | -20.6182927404678  occ= 2
MO #2   (A1  #2 ) energy= -1.36953542093936  | -1.43642129162369  | -1.30264955025503  occ= 2
MO #3   (A1  #3 ) energy= -0.686740813777387 | -0.711363240416531 | -0.662118387138242 occ= 2
MO #4   (E1x #1 ) energy= -0.547404255898234 | -0.566760370707123 | -0.528048141089346 occ= 2
MO #5   (E1y #1 ) energy= -0.258002039738626 | -0.656550548952586 | 0.140546469475336  occ= 1
MO #6   (A1  #4 ) energy= 0.0438105840841107 | 0.0430331000053192 | 0.0445880681629025 occ= 0
MO #7   (E1y #2 ) energy= 0.240289696716495  | 0.228695692430933  | 0.251883701002057  occ= 0
MO #8   (A1  #5 ) energy= 0.241636518158801  | 0.240242435873088  | 0.243030600444514  occ= 0
MO #9   (E1x #2 ) energy= 0.245378044690428  | 0.243802504688289  | 0.246953584692566  occ= 0
MO #10  (A1  #6 ) energy= 0.292335583995969  | 0.286907656664648  | 0.297763511327289  occ= 0
MO #11  (A1  #7 ) energy= 0.398445459811178  | 0.394242167773498  | 0.402648751848858  occ= 0
MO #12  (E1x #3 ) energy= 1.37775909708166   | 1.36967849118554   | 1.38583970297778   occ= 0
MO #13  (A1  #8 ) energy= 1.37795896582591   | 1.36992516613741   | 1.38599276551442   occ= 0
MO #14  (E1y #3 ) energy= 1.38152526748155   | 1.31117861806036   | 1.45187191690275   occ= 0
MO #15  (A1  #9 ) energy= 1.46091491352833   | 1.45167927773431   | 1.47015054932235   occ= 0
MO #16  (A1  #10) energy= 1.77556708501168   | 1.75661126844087   | 1.7945229015825    occ= 0
 ** Mulliken pop on meta-lowdin orthogonal AOs  **
 ** Mulliken pop  **
pop of  0 O 1s        1.99999
pop of  0 O 2s        1.77256
pop of  0 O 3s        0.01146
pop of  0 O 4s        0.00226
pop of  0 O 2px       1.99668
pop of  0 O 2py       0.99816
pop of  0 O 2pz       1.56373
pop of  0 O 3px       0.00178
pop of  0 O 3py       0.00027
pop of  0 O 3pz       0.00529
pop of  0 O 4px       0.00155
pop of  0 O 4py       0.00157
pop of  0 O 4pz       0.00097
pop of  1 H 1s        0.60790
pop of  1 H 2s        0.02134
pop of  1 H 3s        0.01450
 ** Mulliken atomic charges  **
charge of  0O =     -0.35627
charge of  1H =      0.35627
Dipole moment(X, Y, Z, Debye):  0.00000,  0.00000,  2.14574
#INFO: **** input file is /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/6-31ppg/radical/R_0.86/main.py ****
import numpy as np
import sys
sys.path.append('../../../../nevpt2/src/')
import time
from basis_constructor import Basis_Constructor
from bo_class          import BO_class
from bo_solver         import BO_solver
from fci_qse_solver    import FCI_QSE_solver
from fci_solver        import FCI_solver
from vqe_qse_solver    import VQE_QSE_solver
from pyscf             import gto,scf
from VQE_types         import vqe_data

start = time.time()

outfile = open('results.txt','w')
mol = gto.M(atom=[['O',(0,0,0)],['H',(0,0,0.86)]],basis='6-31++g',spin=1,charge=0,
            symmetry=True,verbose=4).build()
mf  = scf.ROHF(mol)
mf  = scf.newton(mf)
mf.kernel()
if(not mf.converged):
   mf.kernel(mf.make_rdm1())
mf.analyze()

BC_object = Basis_Constructor(mol,mf)
BC_object.compute_core_valence()
BC_object.compute_external()

BO_IAO = BO_class(mol,mf)
BO_IAO.transform_integrals(BC_object.valence)
BO_IAO = BO_IAO.freeze_orbitals([0])
BO_IAO_solver = BO_solver(BO_IAO)
#outfile.write("IAO, [1s frozen] SCF energy %.12f \n" % BO_IAO_solver.solve_with_scf()[1])
#outfile.write("IAO, [1s frozen] FCI energy %.12f \n" % BO_IAO_solver.solve_with_fci()[0])

BO_IAO_external = BO_class(mol,mf)
BO_IAO_external.transform_integrals(BC_object.return_basis())
BO_IAO_external = BO_IAO_external.freeze_orbitals([0])
BO_IAO_external_solver = BO_solver(BO_IAO_external)
#outfile.write("FULL, [1s frozen] SCF energy %.12f \n" % BO_IAO_external_solver.solve_with_scf()[1])
#outfile.write("FULL, [1s frozen] FCI energy %.12f \n" % BO_IAO_external_solver.solve_with_fci()[0])

SOLVER = FCI_solver(BO_IAO,BO_IAO_external)
#outfile.write("FCI+FCI [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())
SOLVER = FCI_QSE_solver(BO_IAO,BO_IAO_external)
outfile.write("FCI+QSE [1s frozen] NEVPT2 energy  %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

VQE_settings = vqe_data()
SOLVER = VQE_QSE_solver(BO_IAO,BO_IAO_external)
VQE_settings.target_sector = 11
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(q-UCCSD)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_q_uccsd_output.npy',allow_pickle=True).item()
outfile.write("VQE(q-UCCSD) energy %.12f \n" % x['energy'])

x = np.load('PARAMETER_FILE.npy',allow_pickle=True).item()
VQE_settings.initial_point = x['opt_params']

VQE_settings.ansatz = 'su2'
VQE_settings.optimizer = 'cg'
VQE_settings.reps = 3
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(Ry)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_su2_output.npy',allow_pickle=True).item()
outfile.write("VQE(Ry) energy (I) %.12f \n" % x['energy'])
VQE_settings.instance = 'statevector_simulator'
VQE_settings.optimizer = 'cobyla'
VQE_settings.max_iter = 0
VQE_settings.initial_point = x['opt_params']
SOLVER.set_quantum_variables(VQE_settings)
outfile.write("VQE(Ry)+QSE [1s frozen] NEVPT2 energy %.12f \n" % SOLVER.compute_nevpt2_energy())

#  -----------------------------------------------------------------------------

x = np.load('vqe_su2_output.npy',allow_pickle=True).item()
outfile.write("VQE(Ry) energy (II) %.12f \n" % x['energy'])

end = time.time()

outfile.write("Total time execution %.2f s\n" % (end-start))
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='lab23.labcalcolo.lab', release='4.18.0-348.7.1.el8_5.x86_64', version='#1 SMP Tue Dec 21 19:02:23 UTC 2021', machine='x86_64', processor='x86_64')  Threads 12
Python 3.8.8 (default, Apr 13 2021, 19:58:26) 
[GCC 7.3.0]
numpy 1.20.1  scipy 1.6.2
Date: Tue Jan 25 14:06:59 2022
PySCF version 2.0.1
PySCF path  /home/studenti/alessandro.tammaro/.local/lib/python3.8/site-packages/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 0
[INPUT] num. electrons = 0
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom

nuclear repulsion = 0
number of shells = 0
number of NR pGTOs = 0
number of NR cGTOs = 0
basis = sto-3g
ecp = {}
CPU time:        22.66

WARN: Newton solver expects mo_coeff with mo_occ as initial guess but mo_occ is not found in the arguments.
      The given argument is treated as density matrix.





******** <class 'pyscf.scf.rohf.ROHF'> ********
method = ROHF-RHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/6-31ppg/radical/R_0.86/tmpz0i3bjpa
max_memory 4000 MB (current use 288 MB)
num. doubly occ = 4  num. singly occ = 1
******** <class 'pyscf.scf.rohf.ROHF'> Newton solver flags ********
SCF tol = 1e-09
conv_tol_grad = None
max. SCF cycles = 50
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /home/studenti/alessandro.tammaro/Desktop/freezing_vqe_test/6-31ppg/radical/R_0.86/tmpz0i3bjpa
max_cycle_inner = 12
max_stepsize = 0.05
ah_start_tol = 1e+09
ah_level_shift = 0
ah_conv_tol = 1e-12
ah_lindep = 1e-14
ah_start_cycle = 1
ah_max_cycle = 40
ah_grad_trust_region = 2.5
kf_interval = 4
kf_trust_region = 5
canonicalization = True
max_memory 4000 MB (current use 288 MB)
Set conv_tol_grad to 3.16228e-05
  HOMO = -0.258002039738631  LUMO = 0.517644522888376
Initial guess E= -75.3530943196698  |g|= 0.000469559
macro= 0  E= -75.3530944161626  delta_E= -9.64928e-08  |g|= 0.000469559  1 KF 4 JK
macro= 1  E= -75.3530944161626  delta_E= -1.42109e-14  |g|= 2.1444e-08  1 KF 2 JK
Canonicalize SCF orbitals
macro X = 2  E=-75.3530944161626  |g|= 2.1444e-08  total 3 KF 9 JK
converged SCF energy = -75.3530944161626
u+d contributions  -0.004904233901551079
uu+dd contributions  -0.01604858095873535
ud contributions  -0.04966999814815889
----- VQE data ------
target_sector:  None
optimizer:  bfgs
max_iter:  1000
instance:  statevector_simulator
shots:  1000
ansatz:  q_uccsd
initial_point:  None


qse operators prepared for  u
qse operators prepared for  d
qse operators prepared for  uu
qse operators prepared for  dd
qse operators prepared for  ud
after tapering qubits(H) =  6
qse operators tapered for  hamiltonian
qse operators tapered for  qse_s_u
qse operators tapered for  qse_h_u
qse operators tapered for  qse_s_d
qse operators tapered for  qse_h_d
qse operators tapered for  qse_s_uu
qse operators tapered for  qse_h_uu
qse operators tapered for  qse_s_dd
qse operators tapered for  qse_h_dd
qse operators tapered for  qse_s_ud
qse operators tapered for  qse_h_ud
     ┌───┐
q_0: ┤ X ├
     └───┘
q_1: ─────
     ┌───┐
q_2: ┤ X ├
     ├───┤
q_3: ┤ X ├
     └───┘
q_4: ─────
          
q_5: ─────
          
u+d contributions  -0.004905458970236622
uu+dd contributions  -0.016049665925934185
ud contributions  -0.0496612941602868
     ┌───┐
q_0: ┤ X ├
     └───┘
q_1: ─────
     ┌───┐
q_2: ┤ X ├
     ├───┤
q_3: ┤ X ├
     └───┘
q_4: ─────
          
q_5: ─────
          
u+d contributions  -0.0048312959207918536
uu+dd contributions  -0.015985535487047016
ud contributions  -0.04964247666387074
     ┌───┐
q_0: ┤ X ├
     └───┘
q_1: ─────
     ┌───┐
q_2: ┤ X ├
     ├───┤
q_3: ┤ X ├
     └───┘
q_4: ─────
          
q_5: ─────
          
u+d contributions  -0.0048312959207918536
uu+dd contributions  -0.015985535487047016
ud contributions  -0.04964247666387074
